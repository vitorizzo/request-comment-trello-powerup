<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Segnala Guasto</title>
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
  <script>
    const t = TrelloPowerUp.iframe();
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('guasto-form');
      form.addEventListener('submit', async e => {
        e.preventDefault();
        const guasto = form.elements.guasto.value.trim();
        if (!guasto) return;
        // aggiungi commento alla card corrente
        await t.card('id')
          .then(({id}) =>
            t.post(`/1/cards/${id}/actions/comments`, { text: `ðŸ“Œ Guasto: ${guasto}` })
          );
        // chiudi il popup
        t.closePopup();
      });
    });
  </script>
</head>
<body>
  <form id="guasto-form">
    <label>Descrivi il guasto:<br>
      <textarea name="guasto" rows="4" style="width:100%"></textarea>
    </label>
    <button type="submit">Invia</button>
  </form>
</body>
</html>
