<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Get Info</title>
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
</head>
<body>
  <form id="info-form">
    <textarea name="info" rows="4" style="width:100%"></textarea><br>
    <button type="submit">Invia</button>
  </form>
  <script>
    // prendi il context frame
    var t = TrelloPowerUp.iframe();
    // recupera lâ€™id della card passato da onCardButtonClick
    var cardId = t.arg('cardId');

    document
      .getElementById('info-form')
      .addEventListener('submit', function(e) {
        e.preventDefault();
        var info = this.info.value.trim();
        if (!info) return;

        // posta il commento direttamente usando cardId
        t.post('/1/cards/' + cardId + '/actions/comments', {
          text: 'ðŸ“Œ Info: ' + info
        })
        .then(function() {
          t.closePopup();
        });
      });
  </script>
</body>
</html>
